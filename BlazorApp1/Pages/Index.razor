@page "/"
@using System.Timers

<PageTitle>Index</PageTitle>

<h1>TSD2490 - Oblig1</h1>

Finn to like ikoner for å vinne! Klarer du dette? Tviler...

<style>
	.container {
		width: 400px;
	}

	button {
		width: 100px;
		height: 100px;
		font-size: 50px;
	}
</style>

<div class="container">
	<div class="row">
		@foreach (var animal in shuffledAnimals)
		{
			<div class="col-3">
				<button @onclick="@(() => ButtonClick(animal))" type="button" class="btn btn-outline-dark">
					<h1>@animal</h1>
				</button>
			</div>
		}
	</div>
	<div class="row">
		<h2>Ikoner funnet: @matchesFound</h2>
	</div>
	<div class="row">
		<h2>Tid: @TimeDisplay</h2>
	</div>
</div>

@code {
	List<string> animalEmoji = new List<string>()
	{
		"☀","☀",
		"❄","❄",
		"⚡","⚡",
		"💧","💧",
		"🔥","🔥",
		"🌈","🌈",
		"🌙","🌙",
		"⭐","⭐"
	};

	List<string> shuffledAnimals = new List<string>()
	{

	};
	int matchesFound = 0;
	Timer timer;
	int tenthOfSecondsElapsed = 0;
	string TimeDisplay;

	protected override void OnInitialized()
	{
		timer = new Timer(100);
		timer.Elapsed += Timer_Tick;
		SetUpGame();
	}

	private void SetUpGame()
	{
		Random random = new Random();
		shuffledAnimals = animalEmoji
			.OrderBy(item => random.Next())
			.ToList();
		matchesFound = 0;
		tenthOfSecondsElapsed = 0;
	}

	string lastAnimalFound = string.Empty;

	private void ButtonClick(string animal)
	{
		if(lastAnimalFound == string.Empty)
		{
			lastAnimalFound = animal;
			timer.Start();
		}
		else if(lastAnimalFound == animal)
		{
			lastAnimalFound = string.Empty;

			shuffledAnimals = shuffledAnimals
				.Select(a => a.Replace(animal, string.Empty))
				.ToList();

			matchesFound++;
			if(matchesFound == 8)
			{
				timer.Stop();
				TimeDisplay += " - Spill igjen?";
				//restarter gamet
				SetUpGame();
			}
		}
		else
		{
			lastAnimalFound = string.Empty;
		}

	}

	private void Timer_Tick(Object source, ElapsedEventArgs e)
	{
		InvokeAsync(() =>
		{
			tenthOfSecondsElapsed++;
			TimeDisplay = (tenthOfSecondsElapsed / 10F)
			.ToString("0.0 sek");
			StateHasChanged();
		}
		);

	}
}